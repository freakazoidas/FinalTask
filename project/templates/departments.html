{% extends 'base.html' %} {% block content %}
<div class="columns">
  <div class="column is-one-third">
    <h1 class="title">Departments</h1>
    <form method="post" action="{{ url_for('departments.list_departments') }}">
      <div class="field">
        <label class="label">New Department</label>
        <div class="control">
          <input
            class="input"
            type="text"
            name="department_name"
            placeholder="Enter department name"
          />
        </div>
      </div>
      <div class="field">
        <div class="control">
          <button class="button is-primary" type="submit">Create</button>
        </div>
      </div>
      {% with messages = get_flashed_messages() %} {% if messages %}
      <div class="notification is-danger">
        {% for message in messages %}
        <p>{{ message }}</p>
        {% endfor %}
      </div>
      {% endif %} {% endwith %}
    </form>
  </div>
  <div class="column">
    <h2 class="subtitle">All Departments</h2>
    <table class="table">
      <thead>
        <tr>
          <th>Department Name</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for department in departments %}
        <span
          id="department-name-{{ department.id }}-hidden"
          style="display: none"
        >
          {{ department.department_name }}
        </span>
        <tr>
          <td>{{ department.department_name }}</td>
          <td>
            <div class="buttons">
              <a
                href="{{ url_for('departments.department', department_id=department.id) }}"
                class="button is-link"
                >View</a
              >

              <form
                action="{{ url_for('departments.delete_department', department_id=department.id) }}"
                method="POST"
              >
                <button type="submit" class="button is-danger">Delete</button>
              </form>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<script>

  function editDepartment(id, editButton) {
    var departmentNameElement = document.getElementById("department-name-" + id);
    var departmentName = departmentNameElement.value.trim();

    // Set the department name in the hidden span element
    var spanElement = document.getElementById("department-name-" + id + "-hidden");
    spanElement.textContent = departmentName;

    // Submit the update form
    var form = document.getElementById("update-form-" + id);
    form.submit();
  }

    // Create input element and set value
    var inputElement = document.createElement("input");
    inputElement.setAttribute("type", "text");
    inputElement.setAttribute("name", "department_name");
    inputElement.setAttribute("value", departmentName);
    inputElement.classList.add("input");
    inputElement.classList.add("is-medium");

    // Replace department name with input element
    departmentNameElement.replaceWith(inputElement);

    // Replace edit button with save and cancel buttons
    editButton.style.display = "none";
    var saveButton = document.createElement("button");
    saveButton.setAttribute("type", "submit");
    saveButton.setAttribute("form", "update-form-" + id);
    saveButton.classList.add("button", "is-success", "is-medium");
    saveButton.textContent = "Save";
    editButton.parentNode.insertBefore(saveButton, editButton.nextSibling);

    var cancelButton = document.createElement("button");
    cancelButton.setAttribute("type", "button");
    cancelButton.classList.add("button", "is-danger", "is-medium");
    cancelButton.textContent = "Cancel";
    cancelButton.addEventListener("click", function () {
      var spanElement = document.createElement("span");
      spanElement.setAttribute("id", "department-name-" + id);
      spanElement.textContent = departmentName;
      inputElement.replaceWith(spanElement);

      editButton.style.display = "inline-block";
      saveButton.remove();
      cancelButton.remove();
    });
    editButton.parentNode.insertBefore(cancelButton, editButton.nextSibling);

    saveButton.style.display = "inline-block";
    cancelButton.style.display = "inline-block";
  }
</script>
{% endblock %}
